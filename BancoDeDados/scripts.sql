create database SGA
use SGA

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE [dbo].[usp_ObterParametrosProcedure] --'usp_ValidarUsuario'
(
	@NomeProcedure VARCHAR(100)
)
AS
BEGIN
	SELECT
		sys.parameters.name AS Nome,
		sys.types.name AS Tipo,
		sys.parameters.max_length AS Tamanho,
		sys.parameters.precision AS Precisao,
		sys.parameters.scale AS Escala,
		sys.parameters.is_nullable AS AceitaNulo,
		sys.parameters.is_output AS ParametroDeSaida
	FROM
		sys.objects WITH (NOLOCK)
	INNER JOIN
		sys.parameters WITH (NOLOCK)
	ON
		sys.parameters.object_id = sys.objects.object_id
	INNER JOIN
		sys.types  WITH (NOLOCK)
	ON
		sys.types.system_type_id = sys.parameters.system_type_id
	WHERE
		sys.objects.name = @NomeProcedure
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Create TABLE tbl_Usuario(
	Id int identity primary key,
	Usuario varchar(100) not null,
	Senha varchar(100) not null,
	Nome varchar(100) not null,
	Email varchar(100) not null unique,
	Ativo BIT not null,
	Acesso int not null
)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--select * from tbl_Usuario
--INSERT INTO tbl_Usuario SELECT 'kelvin','3244185981728979115075721453575112','Kelvin Santos da Rocha','kelvinsantosdarocha@gmail.com',1,4

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Create PROCEDURE usp_ValidarUsuario
(
	@Usuario varchar(100),
	@Senha varchar(100)
)
AS
BEGIN
	SELECT 
		Id,
		Usuario,
		Nome,
		Email,
		Ativo,
		Acesso
	FROM tbl_Usuario WHERE Usuario = @Usuario AND Senha = @Senha
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create TABLE tbl_Solicitacao
(
	ID INT IDENTITY PRIMARY KEY,	
	Codigo INT NOT NULL,
	AcessoEmail VARCHAR(20) NOT NULL,
	AcessoInternet VARCHAR(20) NOT NULL,		
	DataInicio DATETIME NOT NULL,
	Status INT NOT NULL,
	StatusEmail INT,
	Solicitante VARCHAR(100) NOT NULL,
	DataSolicitacao DATETIME NOT NULL,
	DataCriacao DATETIME,
	Criador VARCHAR(100),
	DataValidacao DATETIME,
	Validador VARCHAR(100)
)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ObterSolicitacoes
AS
BEGIN
	SELECT * FROM tbl_Solicitacao
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ObterSolicitacao
(
	@ID INT
)
AS
BEGIN
	SELECT * FROM tbl_Solicitacao WHERE ID = @ID
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ObterSolicitacaoCompleta
(
	@SolicitacaoID INT
)
AS
BEGIN
	SELECT * FROM View_Solicitacao WHERE SolicitacaoID = @SolicitacaoID
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_CancelarSolicitacao
	@Codigo INT
AS
BEGIN
	UPDATE tbl_Solicitacao SET Status = 4 WHERE Codigo = @Codigo
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_InserirSolicitacao
(
	@Codigo INT,
	@DataInicio datetime = null,
	@Status INT = null,
	@StatusEmail INT = null,
	@AcessoInternet VARCHAR(20) = null,
	@AcessoEmail VARCHAR(20) = null,
	@Solicitante VARCHAR(100),
	@DataSolicitacao datetime,
	@Validador VARCHAR(100) = null,
	@DataValidacao datetime = null,
	@Criador VARCHAR(100) = null,
	@DataCriacao datetime = null
)
AS
BEGIN
	
	IF EXISTS (SELECT 1 FROM tbl_Solicitacao where Codigo = @Codigo)
		BEGIN
			UPDATE
				tbl_Solicitacao
			SET
				DataInicio = ISNULL(@DataInicio,DataInicio),
				Status = ISNULL(@Status,Status),
				StatusEmail = ISNULL(@StatusEmail,StatusEmail),
				AcessoInternet = ISNULL(@AcessoInternet,AcessoInternet),
				AcessoEmail = ISNULL(@AcessoEmail,AcessoEmail),
				Solicitante = @Solicitante,
				DataSolicitacao = @DataSolicitacao,
				Validador = ISNULL(@Validador,Validador),
				DataValidacao = ISNULL(@DataValidacao,DataValidacao),
				Criador = ISNULL(@Criador,Criador),
				DataCriacao = ISNULL(@DataCriacao,DataCriacao)

			WHERE
				Codigo = @Codigo
		END

	ELSE
		BEGIN
			INSERT INTO
				tbl_Solicitacao
			(
				Codigo,
				DataInicio,
				Status,
				Solicitante,
				DataSolicitacao,
				AcessoInternet,
				AcessoEmail
			)
			VALUES
			(
				@Codigo,
				@DataInicio,
				@Status,
				@Solicitante,
				@DataSolicitacao,
				@AcessoInternet,
				@AcessoEmail				
			)
			Select @@IDENTITY
		END
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_Colaboradores
(
	Codigo INT PRIMARY KEY NOT NULL,
	NomeCompleto VARCHAR(100) NOT NULL,
	Empresa VARCHAR(100) NOT NULL,
	Cargo VARCHAR(100) NOT NULL,
	Superior VARCHAR(100) NOT NULL,
	TipoContrato varchar(20) NOT NULL,
	CentroCusto INT NOT NULL
)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ObterColaboradores
AS
BEGIN
	SELECT * FROM tbl_Colaboradores
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ObterColaborador
(
	@Codigo INT
)
AS
BEGIN
	SELECT * FROM tbl_Colaboradores where Codigo = @Codigo
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ExcluirColaborador
(
	@Codigo INT
)
AS
BEGIN
	DELETE FROM tbl_Colaboradores WHERE Codigo = @Codigo
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_InserirColaborador
(
	@Codigo INT,
	@NomeCompleto VARCHAR(100),
	@Empresa VARCHAR(100),
	@Cargo VARCHAR(100),
	@Superior VARCHAR(100),
	@TipoContrato VARCHAR(20),
	@CentroCusto INT
)
AS
BEGIN
	IF EXISTS (SELECT 1 FROM tbl_Colaboradores where Codigo = @Codigo)
		BEGIN
			UPDATE
				tbl_Colaboradores
			SET
				NomeCompleto = @NomeCompleto,
				Empresa = @Empresa,
				Cargo = @Cargo,
				Superior = @Superior,
				TipoContrato = @TipoContrato,
				CentroCusto = @CentroCusto
			WHERE
				Codigo = @Codigo

		END

	ELSE
		BEGIN
			INSERT INTO
				tbl_Colaboradores
			(
				Codigo,
				NomeCompleto,
				Empresa,
				Cargo,
				Superior,
				TipoContrato,
				CentroCusto
			)
			VALUES
			(
				@Codigo,
				@NomeCompleto,
				@Empresa,
				@Cargo,
				@Superior,
				@TipoContrato,
				@CentroCusto				
			)
			Select @Codigo
		END
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

select * from tbl_Departamento

CREATE TABLE tbl_Departamento
(
	ID INT PRIMARY KEY IDENTITY NOT NULL,
	CentroCusto INT UNIQUE NOT NULL,
	Nome VARCHAR(50) NOT NULL,
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_InserirDepartamento
@ID INT = 0,
@CentroCusto INT,
@Nome varchar(50)
AS
BEGIN
	IF EXISTS( SELECT 1 FROM tbl_Departamento where ID = @ID)
	BEGIN
		UPDATE tbl_Departamento
		SET
			Nome = @Nome,
			CentroCusto = @CentroCusto
		WHERE ID = @ID
	END
	ELSE
	BEGIN
		INSERT INTO tbl_Departamento (CentroCusto,Nome) VALUES (@CentroCusto,@Nome)
		SELECT @@IDENTITY
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ExcluirDepartamento
@ID INT
AS
BEGIN
	DELETE FROM tbl_Departamento WHERE ID = @ID
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterDepartamentos 
@Nome varchar(50) = null
AS
BEGIN
	IF(@Nome IS NOT NULL)
	BEGIN
		SELECT * FROM tbl_Departamento WHERE Nome LIKE '%' + @Nome + '%'
	END
	ELSE
	BEGIN
		SELECT * FROM tbl_Departamento
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_Contratos
(
	ID INT NOT NULL IDENTITY PRIMARY KEY,
	Nome VARCHAR(30) NOT NULL
)

INSERT INTO tbl_Contratos SELECT 'Profissional'
INSERT INTO tbl_Contratos SELECT 'Terceiro'

CREATE PROCEDURE usp_ObterContratos
AS
BEGIN
	SELECT * FROM tbl_Contratos
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_AcessoSistemas
(
	Codigo INT NOT NULL,
	ID_Sistema INT NOT NULL
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_Sistemas
(
	ID INT IDENTITY PRIMARY KEY NOT NULL,
	Nome VARCHAR(100) NOT NULL
)

INSERT INTO tbl_Sistemas SELECT 'Apdata'
INSERT INTO tbl_Sistemas SELECT 'iPlan'
INSERT INTO tbl_Sistemas SELECT 'Natura'
INSERT INTO tbl_Sistemas SELECT 'JobTrack'
INSERT INTO tbl_Sistemas SELECT 'iQuote'
INSERT INTO tbl_Sistemas SELECT 'MCI'
INSERT INTO tbl_Sistemas SELECT 'WipTracker'
INSERT INTO tbl_Sistemas SELECT 'TOTVS'

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterSistemas
AS
BEGIN
	SELECT * FROM tbl_Sistemas
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_InserirSistemaColaborador
	@ID INT,
	@Codigo INT
AS
BEGIN
	INSERT INTO tbl_AcessoSistemas (ID_Sistema,Codigo) VALUES (@ID, @Codigo)
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE usp_ExcluirSistemaColaborador
	@Codigo INT
AS
BEGIN
	DELETE FROM tbl_AcessoSistemas WHERE Codigo =  @Codigo
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE VIEW View_Solicitacao
AS
	SELECT 
		SOL.ID AS SolicitacaoID,
		SOL.Codigo,
		COL.NomeCompleto,
		COL.Empresa,
		COL.Cargo,
		COL.Superior,
		COL.TipoContrato,
		DEP.Nome AS Departamento,
		DEP.CentroCusto,
		SOL.DataInicio,
		SOL.Status,
		SOL.StatusEmail,
		SOL.AcessoEmail,
		SOL.AcessoInternet,
		SOL.DataSolicitacao,
		SOL.Solicitante,
		SOL.DataCriacao,
		SOL.Criador,
		SOL.Validador,
		SOL.DataValidacao
	FROM 
		tbl_Solicitacao SOL
	INNER JOIN 
		tbl_Colaboradores COL ON COL.Codigo = SOL.Codigo
	INNER JOIN 
		tbl_Departamento DEP oN DEP.CentroCusto = COL.CentroCusto

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT * FROM View_Solicitacao

select * from tbl_Solicitacao
--update tbl_Solicitacao set Status = 1
select * from tbl_Colaboradores
select * from tbl_AcessoSistemas
select * from tbl_Departamento
select * from tbl_Sistemas
select * from tbl_Usuario

--TRUNCATE TABLE tbl_Colaboradores
--TRUNCATE TABLE tbl_AcessoSistemas

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterUsuarios 
(
	@Nome VARCHAR(50) = NULL
)
AS
BEGIN
	IF(@Nome IS NOT NULL)
	BEGIN
		SELECT ID,Usuario,Nome,Email,Ativo,Acesso FROM tbl_Usuario WHERE Nome like '%' + @Nome + '%'
	END
	ELSE
	BEGIN
		SELECT ID,Usuario,Nome,Email,Ativo,Acesso FROM tbl_Usuario
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterListaEmails
(
	@Acesso INT = null
)
AS
BEGIN	
	SELECT ID,Usuario,Nome,Email,Ativo,Acesso FROM tbl_Usuario where Acesso = ISNULL(@Acesso,Acesso)
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
select * from tbl_Usuario
select * from tbl_DireitosUsuario where Usuario = 'kelvin'

CREATE PROCEDURE usp_InserirUsuario 
(
	@Usuario VARCHAR(50),
	@Nome VARCHAR(100),
	@Email VARCHAR(100),
	@Ativo INT,
	@Acesso INT,
	@Senha VARCHAR(50) = null
)
AS
BEGIN
	IF EXISTS (SELECT 1 FROM tbl_Usuario where Usuario = @Usuario)
		BEGIN
			IF(@Senha is null)
				BEGIN
					UPDATE
						tbl_Usuario
					SET
						Nome = @Nome,
						Email = @Email,
						Ativo = @Ativo,
						Acesso = @Acesso
					WHERE
						Usuario = @Usuario
					Select ID from tbl_Usuario where Usuario = @Usuario
				END
			ELSE
				BEGIN
					UPDATE
						tbl_Usuario
					SET
						Nome = @Nome,
						Email = @Email,
						Ativo = @Ativo,
						Acesso = @Acesso,
						Senha = ISNULL(@Senha,Senha)
					WHERE
						Usuario = @Usuario
					Select ID from tbl_Usuario where Usuario = @Usuario
				END
		END

	ELSE
		BEGIN
			INSERT INTO
				tbl_Usuario
			(
				Usuario,
				Nome,
				Email,
				Ativo,
				Acesso,
				Senha
			)
			VALUES
			(
				@Usuario,
				@Nome,
				@Email,
				@Ativo,
				@Acesso,
				@Senha			
			)
			Select ID from tbl_Usuario where Usuario = @Usuario
		END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

select * from tbl_Usuario

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ExcluirUsuario
(
	@Usuario VARCHAR(50)
)
AS
BEGIN
	DELETE FROM tbl_Usuario WHERE Usuario = @Usuario
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT * FROM tbl_Usuario

CREATE PROCEDURE usp_ObterUsuario --null,'kelvinsantosdarocha@gmail.com'
(
@Usuario VARCHAR(50) = null,
@Email VARCHAR(200) = NULL
)
AS 
BEGIN
	IF(@Usuario is null)
		BEGIN
			SELECT * FROM tbl_Usuario WHERE Email = @Email
		END
	ELSE
		BEGIN
			SELECT * FROM tbl_Usuario WHERE Usuario = @Usuario
		END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterSolicitacoesCompleta --null,0,'TI PRODU��O',null,null,0,'01/01/1753 00:00:00','01/01/1753 00:00:00','01/01/1753 00:00:00','01/01/1753 00:00:00'
(
	@Nome varchar(50) = null,
	@Codigo INT = 0,
	@Departamento varchar(100) = null,
	@Cargo varchar(100) = null,
	@Empresa varchar(100) = null,
	@Status INT = 0,
	@DataInicio datetime = null,
	@DataFim datetime = null,
	@DataInicioSolicitacao datetime = null,
	@DataFimSolicitacao datetime = null
)
AS
BEGIN
IF(@Nome is not null and @Codigo = 0)
	BEGIN
		PRINT 'Pesquisa por Nome'
		SELECT * FROM View_Solicitacao WHERE NomeCompleto like '%' + @Nome + '%'
	END

ELSE IF(@Codigo <> 0)
	BEGIN
		PRINT 'Pesquisa por C�digo'
		SELECT 
			* 
		FROM 
			View_Solicitacao 
		WHERE 
			CAST(Codigo AS varchar(20)) LIKE '%' + CAST(@Codigo AS varchar(20)) + '%'
	END

ELSE IF (@DataInicio = '1753-01-01' AND @DataFim = '1753-01-01' AND @DataInicioSolicitacao = '1753-01-01' AND @DataFimSolicitacao = '1753-01-01')
	BEGIN
		PRINT 'Pesquisa sem Datas'
		SELECT 
			* 
		FROM 
			View_Solicitacao
		WHERE
			Departamento = ISNULL(@Departamento, Departamento)
	        AND Cargo = ISNULL(@Cargo, Cargo)
	        AND Empresa = ISNULL(@Empresa, Empresa)
	        AND (Status = @Status OR @Status = 0)
	END

ELSE IF (@DataInicio <> '1753-01-01' AND @DataFim <> '1753-01-01' AND @DataInicioSolicitacao = '1753-01-01' AND @DataFimSolicitacao = '1753-01-01')
	BEGIN
		PRINT 'Pesquisa por Data Inicio'
		SELECT 
			* 
		FROM 
			View_Solicitacao
		WHERE
			Departamento = ISNULL(@Departamento, Departamento)
	        AND Cargo = ISNULL(@Cargo, Cargo)
	        AND Empresa = ISNULL(@Empresa, Empresa)
	        AND (Status = @Status OR @Status = 0)
			AND DataInicio BETWEEN @DataInicio AND @DataFim
	END

ELSE IF (@DataInicioSolicitacao <> '1753-01-01' AND @DataFimSolicitacao <> '1753-01-01' AND @DataInicio = '1753-01-01' AND @DataFim = '1753-01-01')
	BEGIN
		PRINT 'Pesquisa por Data Solicitacao'
		SELECT 
			* 
		FROM 
			View_Solicitacao
		WHERE
			Departamento = ISNULL(@Departamento, Departamento)
	        AND Cargo = ISNULL(@Cargo, Cargo)
	        AND Empresa = ISNULL(@Empresa, Empresa)
	        AND (Status = @Status OR @Status = 0)
			AND DataSolicitacao BETWEEN @DataInicioSolicitacao AND @DataFimSolicitacao
	END

ELSE IF (@DataInicioSolicitacao <> '1753-01-01' AND @DataFimSolicitacao <> '1753-01-01' AND @DataInicio <> '1753-01-01' AND @DataFim <> '1753-01-01')
	BEGIN
		PRINT 'Pesquisa pelas duas datas'
		SELECT 
			* 
		FROM 
			View_Solicitacao
		WHERE
			Departamento = ISNULL(@Departamento, Departamento)
	        AND Cargo = ISNULL(@Cargo, Cargo)
	        AND Empresa = ISNULL(@Empresa, Empresa)
	        AND (Status = @Status OR @Status = 0)
			AND DataInicio BETWEEN @DataInicio AND @DataFim
			AND DataSolicitacao BETWEEN @DataInicioSolicitacao AND @DataFimSolicitacao
	END

ELSE
	BEGIN
		PRINT 'Pesquisa sem where'
		SELECT * FROM View_Solicitacao
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterAcessosSistemas
	@Codigo INT
AS
BEGIN
	SELECT 
		tbl_AcessoSistemas.Codigo,
		tbl_Sistemas.Nome,
		tbl_Sistemas.ID
	FROM 
		tbl_AcessoSistemas
	INNER JOIN 
		tbl_Sistemas ON ID = ID_Sistema
	WHERE 
		Codigo = @Codigo
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_Empresa
(
	ID INT PRIMARY KEY IDENTITY NOT NULL,
	Nome VARCHAR(50) NOT NULL,
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_InserirEmpresa
@ID INT = 0,
@Nome varchar(50)
AS
BEGIN
	IF EXISTS( SELECT 1 FROM tbl_Empresa where ID = @ID)
	BEGIN
		UPDATE tbl_Empresa
		SET
			Nome = @Nome
		WHERE ID = @ID
	END
	ELSE
	BEGIN
		INSERT INTO tbl_Empresa (Nome) VALUES (@Nome)
		SELECT @@IDENTITY
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_ExcluirEmpresa
@ID INT
AS
BEGIN
	DELETE FROM tbl_Empresa WHERE ID = @ID
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_ObterEmpresas
@Nome varchar(50) = null
AS
BEGIN
	IF(@Nome IS NOT NULL)
	BEGIN
		SELECT * FROM tbl_Empresa WHERE Nome LIKE '%' + @Nome + '%'
	END
	ELSE
	BEGIN
		SELECT * FROM tbl_Empresa
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterEmpresa
(
@ID INT
)
AS 
BEGIN
	SELECT * FROM tbl_Empresa WHERE ID = @ID
END
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_Cargos
(
	ID INT PRIMARY KEY IDENTITY NOT NULL,
	Nome VARCHAR(50) NOT NULL,
	CentroCusto INT NOT NULL
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_InserirCargo
@ID INT = 0,
@Nome varchar(50),
@CentroCusto INT
AS
BEGIN
	IF EXISTS( SELECT 1 FROM tbl_Cargos where ID = @ID)
	BEGIN
		UPDATE tbl_Cargos
		SET
			Nome = @Nome,
			CentroCusto = @CentroCusto
		WHERE ID = @ID
	END
	ELSE
	BEGIN
		INSERT INTO tbl_Cargos (Nome,CentroCusto) VALUES (@Nome,@CentroCusto)
		SELECT @@IDENTITY
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_ExcluirCargo
@ID INT
AS
BEGIN
	DELETE FROM tbl_Cargos WHERE ID = @ID
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create PROCEDURE usp_ObterCargos
@CentroCusto INT = null
AS
BEGIN
	IF(@CentroCusto IS NOT NULL)
	BEGIN
		SELECT * FROM tbl_Cargos WHERE @CentroCusto = @CentroCusto
	END
	ELSE
	BEGIN
		SELECT * FROM tbl_Cargos
	END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterCargo
(
@ID INT
)
AS 
BEGIN
	SELECT * FROM tbl_Cargos WHERE ID = @ID
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE tbl_DireitosUsuario
(
	CodTela INT NOT NULL,
	Usuario VARCHAR(50) NOT NULL
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterDireitosUsuario
(
	@Usuario VARCHAR(50)
)
AS
BEGIN
	SELECT CodTela FROM tbl_DireitosUsuario where Usuario = @Usuario		
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_InserirDireitosUsuario
(
	@Usuario varchar(50),
	@CodTela INT
)
AS
BEGIN
	INSERT INTO tbl_DireitosUsuario (CodTela,Usuario) Values (@CodTela,@Usuario)
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ExcluirDireitosUsuario
(
	@Usuario varchar(50)
)
AS
BEGIN
	Delete from tbl_DireitosUsuario where Usuario = @Usuario
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--LOGS

create TABLE Log_Solicitacoes
(
	ID INT PRIMARY KEY IDENTITY NOT NULL,
	Data DATETIME NOT NULL,
	Usuario varchar(100) NOT NULL,
	Status INT NOT NULL,
	StatusEmail INT NOT NULL,
	SolicitacaoID INT NOT NULL,
	Descricao varchar(200) not null
)


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterLogSolicitacoes
(
	@SolicitacaoID INT = 0
)
AS
BEGIN
	IF(@SolicitacaoID <> 0)
		BEGIN
			SELECT * FROM Log_Solicitacoes where SolicitacaoID = @SolicitacaoID
		END
	ELSE
		BEGIN
			SELECT * FROM Log_Solicitacoes
		END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_InserirLogSolicitacoes
(
	@Data datetime,
	@Usuario varchar(100),
	@Status INT,
	@StatusEmail INT,
	@SolicitadaoID INT,
	@Descricao varchar(200)
)
AS
BEGIN
	INSERT INTO Log_Solicitacoes (Data,Usuario,Status,StatusEmail,SolicitacaoID,Descricao) Values (@Data,@Usuario,@Status,@StatusEmail,@SolicitadaoID,@Descricao)
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

select * from tbl_Cargos

INSERT INTO TBL_CARGOS SELECT 'Analista De Segurança Sênior',41100
INSERT INTO TBL_CARGOS SELECT 'Analista De Sistemas',	41100
INSERT INTO TBL_CARGOS SELECT 'Analista De Sistemas Sr',	41100
INSERT INTO TBL_CARGOS SELECT 'Analista Programador Jr',	41100
INSERT INTO TBL_CARGOS SELECT 'Analista Programador Sr',	41100
INSERT INTO TBL_CARGOS SELECT 'Assistente De Suporte',	41100
INSERT INTO TBL_CARGOS SELECT 'Coordenador De Ti',	41100
INSERT INTO TBL_CARGOS SELECT 'Lider De Projetos',	41100
INSERT INTO TBL_CARGOS SELECT 'Ajudante Geral',	44000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Impressão Digital',	44000
INSERT INTO TBL_CARGOS SELECT 'Coordenador De Acabamento',	44000
INSERT INTO TBL_CARGOS SELECT 'Lider De Acabamento',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Acabamento',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Grampeadeira',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Grampeadeira Sp',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Lombada Quadrada',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Lombada Quadrada II',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Equipamentos Auxiliares De Acabamento',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Grampeadeira',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Grampeadeira Sp',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Sitma',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Sitma E Ink Jet',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador Lombada Quadrada',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador Lombada Quadrada II',	44000
INSERT INTO TBL_CARGOS SELECT 'Preparador De Maquina',	44000
INSERT INTO TBL_CARGOS SELECT 'Ajudante Geral',	44000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Acabamento',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Grampeadeira',	44000
INSERT INTO TBL_CARGOS SELECT 'Operador De Sitma',	44000
INSERT INTO TBL_CARGOS SELECT 'Analista De Insumos Jr',	47200
INSERT INTO TBL_CARGOS SELECT 'Analista Insumos Sr',	47200
INSERT INTO TBL_CARGOS SELECT 'Analista Materiais',	47200
INSERT INTO TBL_CARGOS SELECT 'Assistente Adm.De Insumos',	47200
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Insumos',	47200
INSERT INTO TBL_CARGOS SELECT 'Coordenador Adm.Insumos',	47200
INSERT INTO TBL_CARGOS SELECT 'Analista De Atendimento Ao Cliente',	49000
INSERT INTO TBL_CARGOS SELECT 'Analista De Produto',	49000
INSERT INTO TBL_CARGOS SELECT 'Assistente De Atendimento Ao Cliente',	49000
INSERT INTO TBL_CARGOS SELECT 'Analista De Compras Jr',	16000
INSERT INTO TBL_CARGOS SELECT 'Analista De Compras Senior',	16000
INSERT INTO TBL_CARGOS SELECT 'Lider De Compras',	16000
INSERT INTO TBL_CARGOS SELECT 'Analista Adm De Papel E Tinta Sr',	47100
INSERT INTO TBL_CARGOS SELECT 'Analista Adm Papel E Tinta Jr',	47100
INSERT INTO TBL_CARGOS SELECT 'Assistente Adm. Papel E Tinta',	47100
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Insumos (Papel E Tinta)',	47100
INSERT INTO TBL_CARGOS SELECT 'Analista De Qualidade Junior',	46000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Controle De Qualidade',	46000
INSERT INTO TBL_CARGOS SELECT 'Inspetor De Qualidade Junior',	46000
INSERT INTO TBL_CARGOS SELECT 'Inspetor De Qualidade Pleno',	46000
INSERT INTO TBL_CARGOS SELECT 'Inspetor De Qualidade Senior',	46000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Impressão',	43012
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Produção (Custom Web)',	43012
INSERT INTO TBL_CARGOS SELECT 'Impressor I',	43012
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Impressão',	43012
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Impressão II',	43012
INSERT INTO TBL_CARGOS SELECT 'Analista Contabil Jr',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista Contabil Sr',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista De Contas A Pagar',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista De Contas A Receber',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista De Custos',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista De Planejamento Financeiro',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista Financeiro',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista Fiscal',	12000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Adm Financeiro',	12000
INSERT INTO TBL_CARGOS SELECT 'Lider De Controladoria',	12000
INSERT INTO TBL_CARGOS SELECT 'Analista De Marketing',	13000
INSERT INTO TBL_CARGOS SELECT 'Analista De Orçamentos Jr',	13000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Comercial',	13000
INSERT INTO TBL_CARGOS SELECT 'Coordenador De Licitação E Clientes Internacionais',	13000
INSERT INTO TBL_CARGOS SELECT 'Executivo De Negocios Jr',	13000
INSERT INTO TBL_CARGOS SELECT 'Executivo De Negócios Sr',	13000
INSERT INTO TBL_CARGOS SELECT 'Lider De Marketing',	13000
INSERT INTO TBL_CARGOS SELECT 'Analista De Atendimento Ao Cliente',	49100
INSERT INTO TBL_CARGOS SELECT 'Analista De Logística Sênior',	49100
INSERT INTO TBL_CARGOS SELECT 'Assistente De Atendimento Ao Cliente',	49100
INSERT INTO TBL_CARGOS SELECT 'Assistente Logística',	49100
INSERT INTO TBL_CARGOS SELECT 'Ajudante Geral',	44900
INSERT INTO TBL_CARGOS SELECT 'Analista De Logística Pleno',	44900
INSERT INTO TBL_CARGOS SELECT 'Analista De Logística Sênior',	44900
INSERT INTO TBL_CARGOS SELECT 'Assistente Logística',	44900
INSERT INTO TBL_CARGOS SELECT 'Conferente De Logística',	44900
INSERT INTO TBL_CARGOS SELECT 'Coordenador De Logistica',	44900
INSERT INTO TBL_CARGOS SELECT 'Analista R.H. Jr',	14000
INSERT INTO TBL_CARGOS SELECT 'Analista R.H. Sr',	14000
INSERT INTO TBL_CARGOS SELECT 'Assistente De Rh',	14000
INSERT INTO TBL_CARGOS SELECT 'Coordenador R.H.',	14000
INSERT INTO TBL_CARGOS SELECT 'Lider De Gestao Humana & Projetos Sociais',	14000
INSERT INTO TBL_CARGOS SELECT 'Ajudante Geral',	43000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Impressão',	43000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Impressão II',	43000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Producao (Impressão)',	43000
INSERT INTO TBL_CARGOS SELECT 'Coordenador De Impressão',	43000
INSERT INTO TBL_CARGOS SELECT 'Impressor I',	43000
INSERT INTO TBL_CARGOS SELECT 'Lider Impressão',	43000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Impressão',	43000
INSERT INTO TBL_CARGOS SELECT 'Meio Oficial De Impressão II',	43000
INSERT INTO TBL_CARGOS SELECT 'Preparador De Impressão',	43000
INSERT INTO TBL_CARGOS SELECT 'Analista De Manutenção Eletrônica',	45000
INSERT INTO TBL_CARGOS SELECT 'Analista De Manutenção Eletrônica Sênior',	45000
INSERT INTO TBL_CARGOS SELECT 'Analista De Manutenção Mecânica',	45000
INSERT INTO TBL_CARGOS SELECT 'Analista De Projetos',	45000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Manutenção Eletrônica',	45000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Manutenção Mecânica',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Eletronico Junior',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Eletronico Pleno',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Eletronico Senior',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Mecanico Junior',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Mecanico Pleno',	45000
INSERT INTO TBL_CARGOS SELECT 'Tecnico Mecanico Senior',	45000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar De Producao (Impressão)',	48000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Planejamento De Produção',	48000
INSERT INTO TBL_CARGOS SELECT 'Programador De Ppcp',	48000
INSERT INTO TBL_CARGOS SELECT 'Programador De Ppcp Junior',	48000
INSERT INTO TBL_CARGOS SELECT 'Analista Pre Impressão Pleno',	42000
INSERT INTO TBL_CARGOS SELECT 'Auxiliar Pre Impressao',	42000
INSERT INTO TBL_CARGOS SELECT 'Coordenador Pré-Impressão',	42000
INSERT INTO TBL_CARGOS SELECT 'Operador Ctp II',	42000
INSERT INTO TBL_CARGOS SELECT 'Operador Ctp III',	42000
INSERT INTO TBL_CARGOS SELECT 'Assistente De Meio Ambiente',	14100
INSERT INTO TBL_CARGOS SELECT 'Coordenador Segurança Do Trabalho & Meio Ambiente',	14100
INSERT INTO TBL_CARGOS SELECT 'Enfermeiro Do Trabalho',	14100
INSERT INTO TBL_CARGOS SELECT 'Medico Coordenador Do Trabalho',	14100
INSERT INTO TBL_CARGOS SELECT 'Técnico De Enfermagem',	14100
INSERT INTO TBL_CARGOS SELECT 'Tecnico De Seguranca Do Trabalho Jr',	14100
INSERT INTO TBL_CARGOS SELECT 'Tecnico De Seguranca Do Trabalho Pl',	14100
INSERT INTO TBL_CARGOS SELECT 'Tecnico De Seguranca Do Trabalho Sr',	14100

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT * FROM tbl_Colaboradores WHERE Codigo = 5542
SELECT * FROM tbl_Solicitacao WHERE Codigo = 79782



select * from tbl_AcessoSistemas where Codigo = 2451

select * from tbl_Acesso where Codigo = 2451

select * from TOTVS..tbl_Usuario
select * from iQuote..tbl_Usuario


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


CREATE TABLE tbl_Acesso
(
	Id int identity primary key,
	Usuario varchar(100) not null,
	Codigo int not null,
	Senha varchar(100) not null,
	Email varchar(100),
	Ativo BIT not null
)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ObterAcesso 
(
	@Codigo INT = 0,
	@Usuario varchar(50) = null
)
AS
BEGIN
	IF(@Codigo = 0 and @Usuario is null)
		BEGIN
			SELECT * FROM tbl_Acesso
		END
	ELSE IF (@Codigo <> 0)
		BEGIN
			SELECT * FROM tbl_Acesso where Codigo = @Codigo		
		END
	ELSE IF (@Usuario is not null)
		BEGIN
			SELECT * FROM tbl_Acesso where Usuario = @Usuario
		END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_InserirAcesso 
(
	@Usuario VARCHAR(50),
	@Codigo INT,
	@Email VARCHAR(100) = null,
	@Ativo INT,
	@Senha VARCHAR(50) = null
)
AS
BEGIN
	IF EXISTS (SELECT 1 FROM tbl_Acesso where Usuario = @Usuario)
		BEGIN
			IF(@Senha is null or @Senha = '')
				BEGIN
					PRINT 'UPDATE SENHA NULL'
					UPDATE
						tbl_Acesso
					SET
						Email = ISNULL(@Email,''),
						Ativo = @Ativo
					WHERE
						Usuario = @Usuario
					Select Id from tbl_Acesso where Usuario = @Usuario
				END
			ELSE
				BEGIN
					PRINT 'UPDATE SENHA NAO NULL'
					UPDATE
						tbl_Acesso
					SET
						Email = ISNULL(@Email,''),
						Ativo = @Ativo,
						Senha = @Senha
					WHERE
						Usuario = @Usuario
					Select Id from tbl_Acesso where Usuario = @Usuario
				END
		END

	ELSE
		BEGIN
			PRINT 'INSERINDO'
			INSERT INTO
				tbl_Acesso
			(
				Usuario,
				Codigo,
				Email,
				Ativo,
				Senha
			)
			VALUES
			(
				@Usuario,
				@Codigo,
				ISNULL(@Email,''),
				@Ativo,
				@Senha			
			)
			Select Id from tbl_Acesso where Usuario = @Usuario
		END
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE PROCEDURE usp_ExcluirAcesso
(
	@Usuario varchar(50)
)
AS
BEGIN
	update tbl_Acesso set Ativo = 0 where Usuario = @Usuario
END

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*****************************************************************************
-- NOME : usp_SelecionarParametrosProcedure
-- DESCRICAO: Obtem os parametros de entrada da procedure informada.
-- CLIENTE : TI
-- PROGRAMADOR : Kelvin Santos
-- DATA : 04/04/2024
****************************************************************************/
CREATE  PROCEDURE [dbo].[usp_SelecionarParametrosProcedure]
(
	@NomeProcedure VARCHAR(100)
)
AS
BEGIN
	SELECT
		sys.parameters.name AS Nome,
		sys.types.name AS Tipo,
		sys.parameters.max_length AS Tamanho,
		sys.parameters.precision AS Precisao,
		sys.parameters.scale AS Escala,
		sys.parameters.is_nullable AS AceitaNulo,
		sys.parameters.is_output AS ParametroDeSaida
	FROM
		sys.objects WITH (NOLOCK)
	INNER JOIN
		sys.parameters WITH (NOLOCK)
	ON
		sys.parameters.object_id = sys.objects.object_id
	INNER JOIN
		sys.types  WITH (NOLOCK)
	ON
		sys.types.system_type_id = sys.parameters.system_type_id
	WHERE
		sys.objects.name = @NomeProcedure
END


